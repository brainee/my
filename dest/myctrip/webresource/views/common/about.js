define(["cPageView","CommonStore","MyCtripModel","myctripCommon","cUtilCommon","cHybridShell","cGuiderService","cMemberService"],function(e,n,o,i,t,a,r,c){var l=e.extend({pageid:"231072",hpageid:"410026",events:{"click div[data-href]":"menuAction","click li[data-href]":"menuAction","click p[data-href]":"menuAction"},onCreate:function(){Lizard.isHybrid&&this.checkTheUpdate()},onShow:function(){var e=this;cPublic.ctripMenu({show:!0,buName:"about"}),this.setTitle("关于携程旅行"),this.headerview.set({title:"关于携程旅行",back:!0,view:e,events:{returnHandler:function(){r.apply({hybridCallback:function(){r.backToLastPage()},callback:function(){Lizard.jump(Lizard.appBaseUrl)}})}}}),this.headerview.show()},onHide:function(){this.hideLoading()},checkTheUpdate:function(){var e=o.AppUpdateServiceModel.getInstance(),n=o.BasicConfInfoModel.getInstance(),i=null,t=this;window.localStorage&&(i=window.localStorage.getItem("CINFO"),i=i?JSON.parse(i):null),i&&(t.checkHasWechat(t),1===i.platform&&t.$el.find(".grade").show(),i.version&&i.version.length>0&&(t.$el.find(".myctrip-v").html("v"+i.version),t.$el.find(".myctrip-v").show()),e.param={AppUpdateHeader:{SystemCode:i.systemCode,ClientVersion:i.internalVersion,SourceID:i.sourceId,ClientId:i.clientID,VesionCode:i.versionCode},NeedIntegratedPKG:!1,RequestFrom:"About"},n.param={Platform:platform,ClientVersion:i.internalVersion,VersionCode:i.versionCode,SourceID:"5555"+i.sourceId},e.execute(function(e){if(t.hideLoading(),e&&void 0!==e.ResultMessage&&"Success"===e.ResultMessage){if(!e.AppUpdateInfo.NeedUpdate)return;var n=e.AppUpdateInfo.DisplayVersion;t.$el.find(".tag-new").show(),t.$el.find(".current-v").html("最新"+n)}},function(e){t.hideLoading(),t.onError(e,!1)},!1,t,function(e){t.hideLoading(),t.onError(e,!1)}),n.execute(function(e){if(t.hideLoading(),e&&void 0!==e.Result&&0===e.Result){if(window.localStorage){var n={};n.ShowUpdateBar=void 0!==e.ShowUpdateBar?e.ShowUpdateBar:!1,n.ShowAppRecom=void 0!==e.ShowAppRecom?e.ShowAppRecom:!1,window.localStorage.removeItem("MYCTRIP_BASICINFOS"),window.localStorage.setItem("MYCTRIP_BASICINFOS",JSON.stringify(n))}if(e.ShowUpdateBar&&t.$el.find(".upgrade").show(),e.ShowAppRecom){if(t.$el.find(".apply").length)return;t.$el.find(".about-list li").append('<div data-href="market" class="about-item ico-apply apply">应用推荐<i class="arrow-r"></i></div>')}}else t.onError(e,!0)},function(e){t.hideLoading(),t.onError(e,!1)},!1,t,function(e){t.hideLoading(),t.onError(e,!1)}))},checkHasWechat:function(e){r.checkAppInstall({url:"weixin://home","package":"com.tencent.mm",callback:function(n){n&&!n.isInstalledApp&&(e.$el.find(".ico-wechat").remove(),e.$el.find(".ico-sina").css({left:"50%",marginLeft:"-80px"}))}})},onError:function(e,n){var o=this,t={};if(i.sendUbtTrace({traceName:"myctrip_about",pageId:o.hpageid,pageName:"about",bServerError:n,err:e}),window.localStorage&&(t=window.localStorage.getItem("MYCTRIP_BASICINFOS"),t=t?JSON.parse(t):null,t&&t.ShowUpdateBar&&o.$el.find(".upgrade").show(),t&&t.ShowAppRecom)){if(o.$el.find(".apply").length)return;o.$el.find(".about-list li").append('<div data-href="market" class="about-item ico-apply apply">应用推荐<i class="arrow-r"></i></div>')}},menuAction:function(e){var o=this,i=$(e.currentTarget).attr("data-href"),l={noticelist:function(){Lizard.goTo(Lizard.appBaseUrl+"common/noticelist")},"new":function(){r.showNewestIntroduction()},upgrade:function(){r.checkUpdate()},feedback:function(){t.isInApp&&a.Fn("do_business_job").run(1,"HYBRID_UBT",{actionname:"c_feedback"},null),Lizard.goTo(Lizard.appBaseUrl+"common/feedback")},agreement:function(){Lizard.goTo(Lizard.appBaseUrl+"common/agreement")},weixin:function(){a.Fn("do_business_job").run(1,"HYBRID_UBT",{actionname:"c_weixin"},null),a.Fn("copy_string_to_clipboard").run("ictrip"),o.showConfirm({datamodel:{content:"公共号“ictrip”已复制。您可以在微信中直接粘贴搜索。",btns:[{name:"取消",className:"cui-btns-cancel"},{name:"<strong>去微信</strong>",className:"cui-btns-ok"}]},okAction:function(){a.Fn("do_business_job").run(1,"HYBRID_UBT",{actionname:"c_weixin_open"},null),a.Fn("open_url").run("weixin://home",10),this.hide()},cancelAction:function(){a.Fn("do_business_job").run(1,"HYBRID_UBT",{actionname:"c_weixin_cancel"},null),this.hide()}})},weibo:function(){a.Fn("do_business_job").run(1,"HYBRID_UBT",{actionname:"c_weibo"},null),a.Fn("open_url").run("http://m.weibo.cn/u/2292409817?jumpfrom=wapv4&tip=1",2,"新浪微博")},market:function(){a.Fn("do_business_job").run(1,"HYBRID_UBT",{actionname:"c_recommend"},null);var e="http://app.ctrip.com/market/app.html";r.jump({targetModel:"h5",url:e,title:"精彩应用"})},recommend:function(){r.recommend()},survey:function(){a.Fn("do_business_job").run(1,"HYBRID_UBT",{actionname:"c_survey"},null);var e=n.UserStore.getInstance(),i="http://m.ctrip.com/html5/market/survey.html";return e.getUser()?(i=i+"?UID="+e.getUser().UserID,r.jump({targetModel:"h5",url:i,title:"参与用户体验改善计划"})):(o.showLoading(),void c.nonMemberLogin({callback:function(){o.hideLoading();var n=e.getUser();return n&&n.UserID&&""!=n.UserID?(i=i+"?UID="+n.UserID,r.jump({targetModel:"h5",url:i,title:"参与用户体验改善计划"})):void 0}}))},question:function(){t.isInApp&&a.Fn("do_business_job").run(1,"HYBRID_UBT",{actionname:"c_question"},null),r.jump({targetModel:"h5",url:"http://m.ctrip.com/webapp/wechat/#help",title:"常见问题"})},grade:function(){a.Fn("do_business_job").run(1,"HYBRID_UBT",{actionname:"c_comment"},null),a.Fn("do_business_job").run(1,"common/openAppComment",null,null)}};"function"==typeof l[i]&&typeof l[i]()}});return l});