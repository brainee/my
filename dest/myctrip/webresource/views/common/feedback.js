define(["cPageView","CommonStore","MyCtripModel","myctripCommon","cUtilHybrid","cUtilValidate","cGuiderService","cMemberService"],function(e,i,t,o,n,a,r,s){var c=i.UserStore.getInstance(),d=t.CustomeFeedbackModel.getInstance(),l=e.extend({pageid:"231074",hpageid:"410028",clickNum:0,events:{"click #js_debug":"checkDebug"},onCreate:function(){},onShow:function(){if(!n.isInApp&&1!==o.checkLogin())return void s.memberLogin({param:"from="+encodeURIComponent(Lizard.appBaseUrl+"common/about")});var e=this;cPublic.ctripMenu({show:!0,buName:"about"}),this.clickNum=0,this.setTitle("意见反馈"),this.headerview.set({title:"意见反馈",back:!0,view:e,btn:{title:"提交",id:"confirmBtn",classname:"header_r"},events:{returnHandler:function(){Lizard.goTo(Lizard.appBaseUrl+"common/about")},commitHandler:function(){e.submit()}}}),this.headerview.show(),setTimeout(this.setDate,300)},onHide:function(){this.hideLoading()},setDate:function(){var e=c?c.getUser():null;e&&($("#js_mobi").val(e.Mobile||""),$("#js_mail").val(e.Email||""))},submit:function(){var e=this,t=null,o=$("#js_mobi").val().trim(),r=$("#js_mail").val().trim(),s=$("#js_content").val().trim();if(""==s)return this.showToast("请输入反馈意见"),!1;if(""!=r&&!a.isEmail(r))return this.showToast("请填写正确的邮箱地址 "),!1;if(n.isInApp&&(window.localStorage&&(t=window.localStorage.getItem("CINFO"),t=t?JSON.parse(t):null),s+=t.device?" "+t.device:""),d.setParam({Mobilephone:o,SendEMailAddress:r,Feedback:s}),this.showLoading(),n.isInApp&&t){var c=i.HeadStore.getInstance(),l=c.get();l.syscode=t.systemCode,l.cver=t.version,d.usehead=!1,d.headinfo=l}d.execute(function(i){e.hideLoading(),i&&i.Result&&0===i.Result.ResultCode?(e.showToast("提交成功"),$("#js_mobi").val(""),$("#js_mail").val(""),$("#js_content").val("")):e.onError(i,!0)},function(i){e.hideLoading(),e.onError(i,!1)},!1,e,function(i){e.hideLoading(),e.onError(i,!1)})},onError:function(e,i){var t=this;this.showToast("抱歉，您的反馈建议未能提交，请拨打客服热线4000086666"),o.sendUbtTrace({traceName:"myctrip_feedback",pageId:t.hpageid,pageName:"feedback",bServerError:i,err:e})},checkDebug:function(){if(4==this.clickNum){"0"==n.isPreProduction()&&alert(""),this.clickNum=0;var e=($("#js_mail").val().trim(),!1);n.isInApp?"1"!=n.isPreProduction()&&"0"!=n.isPreProduction()&&(e=!0):location.host.match(/^m\.ctrip\.com/i)&&(e=!0)}else this.clickNum++}});return l});