define(["cPageList","MyCtripStore","MyCtripModel","cUtilDate","cGuiderService"],function(cPageList,MyCtripStore,MyCtripModel,cUtilDate,Guider){var customerNoticesListModel=MyCtripModel.CustomerNoticesListModel.getInstance(),customerNoticesListStore=MyCtripStore.CustomerNoticesListStore.getInstance(),customerNoticesDateStore=MyCtripStore.CustomerNoticesDateStore.getInstance(),View=cPageList.extend({pageid:"231073",hpageid:"",dataList:[],events:{"click .myc_nlist li":"showNoticeDeatil"},onCreate:function(){},onShow:function(){var t=this;cPublic.ctripMenu({show:!0,buName:"about"}),this.setTitle("携程公告"),this.render(),this.headerview.set({title:"携程公告",back:!0,view:t,events:{returnHandler:function(){Lizard.goTo(Lizard.appBaseUrl+"common/about")}}}),this.headerview.show(),customerNoticesDateStore.setAttr("isread",1),this.getNotices()},render:function(){this.$el.html(Lizard.T("noticelist")),this.elsBox={lsttpl:this.$el.find("#lsttpl"),lstbox:this.$el.find("#lstbox")},this.elsBox.lstbox.empty(),this.lstboxfun=_.template(this.elsBox.lsttpl.html())},onHide:function(){customerNoticesListModel.abort(),customerNoticesDateStore.setAttr("isread",1),this.hideLoading(),this.hideBottomLoading(),this.hideWarning404()},showNoticeDeatil:function(t){var e=$(t.currentTarget).attr("id"),i=this.dataList[e];if(i){var o=MyCtripStore.CustomerNoticesDetailStore.getInstance();o.setAttr("StartDate",i.StartDate),o.setAttr("NoticeBody",i.NoticeBody),o.setAttr("NoticeTitle",i.NoticeTitle),Lizard.goTo(Lizard.appBaseUrl+"common/noticedetail")}},renderList:function(t){var e=this,i="";if(t&&t.Notices&&$.isArray(t.Notices)&&t.Notices.length>0){for(var o=cUtilDate.getServerDate(),s=0,r=t.Notices.length;r>s;s++){var a=t.Notices[s],n=a.StartDate;a.StartDate=n?cUtilDate.format(e.dateParse(n),"Y-m-d H:i"):"",a.i=s,o<e.dateParse(a.EndDate)&&(i+=e.lstboxfun(a))}this.elsBox.lstbox.append(i)}},getNotices:function(){var t=this,e=customerNoticesDateStore.get(),i="1970/1/1 1:01:01";this.showLoading(),e&&e.PublishDate&&"null"!==e.PublishDate&&(i=cUtilDate.format(t.dateParse(e.PublishDate),"Y/m/d H:i:s")),customerNoticesListModel.setParam("PublishDate",i),customerNoticesListModel.excute(function(e){this.hideLoading(),e&&e.Result&&0===e.Result.ResultCode?(e.Notices&&e.Notices.length>0?(this.renderList(e),this.dataList=e.Notices):this.elsBox.lstbox.html('<div class="cui-load-error"><div class="cui-i cui-wifi cui-exclam"></div>暂无公告</div>'),customerNoticesDateStore.setAttr("PublishDate",e.LatestPublishDate)):(customerNoticesListStore.remove(),this.showWarning404(function(){t.hideWarning404(),t.onShow()}))},function(){t.hideLoading(),t.showWarning404(function(){t.hideWarning404(),t.onShow()})},!0,this,function(){t.hideLoading(),t.showWarning404(function(){t.hideWarning404(),t.onShow()})})},dateParse:function(str){return eval("new "+str.replace("/","","g").replace("/","","g"))},onBottomPull:function(){}});return View});