define(["cUIInputClear","cUtilValidate","cLocalStorage","cPageView","cUtility","CommonStore","cMemberService","myctripCommon","MyCtripModel"],function(e,t,i,o,a,n,s,r,c){var l=r.checkLogin(),d=n.UserStore.getInstance(),h=(d.getUser(),c.GetPicValCodeModel.getInstance()),f=c.SendValidateCodeModel.getInstance(),m=c.CheckVerifyCodeModel.getInstance(),g={},u=window.location.host.toLowerCase();if(u.indexOf("fat")>=0||u.indexOf("localhost")>=0)var p="https://accounts.fat49.qa.nt.ctripcorp.com/";else if(u.indexOf("uat")>=0)var p="https://accounts.uat.qa.nt.ctripcorp.com/";else var p="https://accounts.ctrip.com/";var v=!1,w=o.extend({pageid:"212052",onHide:function(){this.hideLoading()},onCreate:function(){this.setTitle("免登录查询"),this.$el.html(Lizard.T("unloginTpl")),g={elmobile:this.$el.find("#mobile"),picVerify:this.$el.find("#putValidateCode"),msgVerify:this.$el.find("#inputVerifyCode"),getValidate:this.$el.find("#getvalidate"),img:this.$el.find("#IValidateCode")};var t=i.localStorage.oldGet("Unlogin_Mobile");t?g.elmobile.val(t):"",e(g.elmobile),e(g.picVerify),e(g.msgVerify)},onShow:function(){3!=l&&0!=l?s.memberLogin():(this.setHead(),this.counter(),this.showVerifyCode())},events:{"click #js_return":"backAction","click .jsreg":"regAction","click .js_getpass":"getPassAction","click #getvalidate":"getCode","click #nologinsubmit":"notloginAction","click #AnotherImg":"showVerifyCode","input #putValidateCode":"setAble","input #mobile":"setAble"},setAble:function(){var e=$.trim(g.picVerify.val()),t=$.trim(g.elmobile.val());thisDom=g.getValidate,isAble=11===t.length?0===e.length:!0,v||(isAble?thisDom.addClass("s"):thisDom.removeClass("s"))},showVerifyCode:function(){var e=this,t=g.img.data("length")||"",i=Math.floor(Math.random()*(1e6+1));h.setParam({length:t,sessionid:i}),h.excute(function(e){e&&(g.img.data("captcbaid",e.captcbaid).attr("src","data:image/png;base64,"+e.imageStr),g.picVerify.val(""),g.getValidate.addClass("s"))},function(){e.showToast("验证码获取失败,请重新获取！")},!0,this,function(){e.showToast("验证码获取失败,请重新获取！")})},setHead:function(){var e=this;e.headerview.set({title:"我的携程",back:!0,view:e,events:{returnHandler:function(){this.backAction()}}}),e.headerview.show()},backAction:function(){var e=(Lizard.P("from")||"").toLowerCase();this.jump(!e||e.length<=0?"/webapp/myctrip/index":e.indexOf("/myctrip")>-1||e.indexOf("orderdetail")>-1?"/webapp/myctrip/index":e)},checkVal:function(){var e=this,i=$.trim(g.elmobile.val()),o=$.trim(g.picVerify.val());return i.length?t.isMobile(i)?o.length<=0?(e.showToast("请输入图片验证码!"),!1):o.length<6?(e.showToast("请输入正确的图片验证码!"),e.showVerifyCode(),!1):!0:(e.showToast("请输入正确的手机号码!"),!1):(e.showToast("请输入手机号!"),!1)},getCode:function(){var e=this,t="s_btn fr"==g.getValidate[0].className;if(t&&e.checkVal()){var o=$.trim(g.elmobile.val()),a=g.img.data("captcbaid"),n=$.trim(g.picVerify.val());i.localStorage.oldSet("Unlogin_Mobile",o),f.setParam({captchaId:a,captchacode:n,mobile:o}),f.excute(function(t){if(t&&t.ServerCode)switch(t.ServerCode){case"1":e.showToast(t.Message||"短信验证码发送成功"),i.localStorage.oldSet("VERIFYTIMEOUT",(new Date).valueOf()),e.counter();break;case"8":e.showToast({datamodel:{content:t.Message||"图片验证码输入错误"},hideAction:function(){e.showVerifyCode()}});break;case"9":e.showToast({datamodel:{content:t.Message||"验证码发送失败，请稍后重试"},hideAction:function(){e.showVerifyCode()}});break;default:e.showToast({datamodel:{content:t.Message||"网络不给力，请稍后重试"},hideAction:function(){e.showVerifyCode()}})}else e.showToast({datamodel:{content:t.Message||"网络不给力，请稍后重试"},hideAction:function(){e.showVerifyCode()}})},function(){e.showToast("网络不给力，请稍后重试"),e.showVerifyCode()},!0,this,function(){e.showToast("网络不给力，请稍后重试"),e.showVerifyCode()})}},counter:function(){var e=60,t=i.localStorage.oldGet("VERIFYTIMEOUT"),o=g.getValidate,a=g.picVerify,n=new Date;if(t){var s,r,c=n.valueOf()-t;if(1e3*e>c)return v=!0,r=e-Math.ceil(c/1e3),s=setInterval($.proxy(function(){if(o.addClass("s"),o.text(r+"秒后重发"),0>=r){clearInterval(s);var e=$.trim(a.val());0===e.length?o.text("获取验证码"):o.removeClass("s").text("获取验证码"),v=!1}r--},this),1e3),o.addClass("s").val(r+"秒后重发"),void r--}},notloginAction:function(){var e=this,t=Lizard.P("from")||"/webapp/myctrip/index",o=$.trim(g.elmobile.val()),a=$.trim(g.msgVerify.val());if(this.checkVal()){if(0===a.length)return void e.showToast("请输入短信验证码!");m.param={Mobile:o,VerifyCode:a},m.excute(function(o){if(e.hideLoading(),1==o.ServerCode){if(o.User){o.User.VerifyCode=a;var n={data:o.User,timeout:new Date};i.localStorage.oldSet("USERINFO",JSON.stringify(n))}e.jump(t,!0)}else e.showToast(o.Message||"抱歉，服务未响应")},function(){e.showToast(data.Message||"抱歉，服务未响应"),e.hideLoading()},!0,this,function(){e.showToast(data.Message||"抱歉，服务未响应"),e.hideLoading()})}},regAction:function(){var e=p+"H5Register/index.html";urlFrom=Lizard.P("from"),e+=urlFrom&&urlFrom.length>0?"?from="+encodeURIComponent(urlFrom):"?from="+encodeURIComponent(this.getRoot()),this.jump(e)},getPassAction:function(){this.jump("https://accounts.ctrip.com/H5Login/ResetPassword")}});return w});