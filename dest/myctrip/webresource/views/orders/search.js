define(["cPageView","MyCtripModel","cMemberService","cUIInputClear","text!template","myctripCommon","cUtilCommon"],function(e,t,r,s,i,a){var o=null,l=e.extend({pageid:"231039",hpageid:"231039",searchFrom:"",queries:[],filters:{allorders:{statuses:[{code:"NULL",name:"不限"},{code:"Uncommitted",name:"未提交/待提交"},{code:"WaitPay",name:"待支付"},{code:"Dealt",name:"已成交/已出票"},{code:"ReturnTicket",name:"退票"}]},hotelorderlist:{types:[{code:"NULL",name:"不限"},{code:"HotelDomestic",name:"国内"},{code:"HotelInternational",name:"海外"},{code:"HotelMask",name:"惠选"}],statuses:[{code:"NULL",name:"不限"},{code:"Uncommit",name:"未提交"},{code:"Confirming",name:"确认中"},{code:"Confirmed",name:"已确认"},{code:"Completed",name:"已成交"},{code:"Cancelled",name:"已取消"}]},flightorderlist:{types:[{code:"NULL",name:"不限"},{code:"FlightDomestic",name:"国内"},{code:"FlightInternational",name:"国际"}],statuses:[{code:"NULL",name:"不限"},{code:"Ticketing",name:"出票中"},{code:"Ticketed",name:"已出票"},{code:"UnsubcribePart",name:"部分退票"},{code:"UnsubcribeAll",name:"全部退票"},{code:"Cancelling",name:"取消申请中"},{code:"Cancelled",name:"已取消"}]}},filter:{type:"NULL",status:"NULL"},events:{"click .tab-model li":"doSwitchAction","click .search-list li":"doFilterAction","click .g_btn_s":"doSearchAction","input .txt_order":"doCheckAction"},onCreate:function(){},onShow:function(){this.bShowMenu=cPublic.ctripMenu({show:!0,buName:"order"}),$("body")[0].scrollTop=0;var e=this;this.getQueries(),this.headerview.set({title:"查找订单",back:!0,view:e,tel:null,home:null,events:{returnHandler:function(){var t="orders/";if(e.referrer=="orders/"+e.searchFrom)t+=e.searchFrom+"?flag=nocache";else if("orders/searchresult"==e.referrer){var r=location.href.indexOf("?")>-1?location.href.slice(location.href.indexOf("?")):"";r?-1===r.indexOf("flag=nocache")&&(r+=",flag=nocache"):r+="?flag=nocache",t+="searchresult"+r}else t+=e.searchFrom;Lizard.goTo(Lizard.appBaseUrl+t)}}});var r=[],a=[];switch(this.searchFrom=this.queries.searchfrom,this.filter.type="NULL",this.filter.status="NULL",o=t.OrdersSearchModel.getInstance(),o.param={ClientVersion:o.param.ClientVersion,Channel:o.param.Channel,OrderStatusClassify:"All",PageIndex:1},this.searchFrom){case"allorders":r=this.filters.allorders.statuses;break;case"hotelorderlist":a=this.filters.hotelorderlist.types,r=this.filters.hotelorderlist.statuses;break;case"flightorderlist":a=this.filters.flightorderlist.types,r=this.filters.flightorderlist.statuses;break;default:this.searchFrom="allorders",r=this.filters.allorders.statuses}var l=(this.queries.byid,this.queries.orderid,this.queries.type),n=this.queries.status;if(l){for(var c=0,d=a.length;d>c;c++)if(a[c].code.toLowerCase()==l.toLowerCase()){l=a[c].code;break}l=c==d?"NULL":l}if(n){for(var c=0,d=r.length;d>c;c++)if(r[c].code.toLowerCase()==n.toLowerCase()){n=r[c].code;break}n=c==d?"NULL":n}this.filter.type=l||"NULL",this.filter.status=n||"NULL";var h=/<script type=\"text\/template\" id=\"searchTpl\">(((?!<\/script>)[\w\W])*)<\/script>/.exec(i),f=h&&h[1]||"",m=_.template(f)({types:a,statuses:r,filter:this.filter});this.$el.html(m),"allorders"==this.searchFrom&&(this.$el.find(".tab-model li").eq(0).text("按状态"),this.$el.find(".search-list.status").css("margin-top","20px").prev(".search-title").hide()),s(this.$el.find("#order_field")),this.bShowMenu&&this.$el.find(".tab-model").css("position","relative"),this.showView()},showView:function(){var e=this,t="from="+encodeURIComponent("/webapp/myctrip/orders/search?searchfrom="+this.searchFrom);if(1!==a.checkLogin()){var s=$.proxy(e.onShow,e);r.memberLogin({param:t,callback:s})}},doSwitchAction:function(e,t){var t=t||$(e.target),r=(t.parent(),t.parent().children().index(t));t.siblings().removeClass("tab-current"),t.addClass("tab-current"),this.$el.find(".search").hide().eq(r).show(),this.$el.find(".txt_order").val(""),this.$el.find(".g_btn_s.order").addClass("g_btns_disable");for(var s=this.$el.find(".search-list"),i=0,a=s.length;a>i;i++)s.eq(i).find("li").removeClass("current").eq(0).addClass("current");this.filter.type="NULL",this.filter.status="NULL",1===r&&$(".txt_order").focus()},doFilterAction:function(e){var t=$(e.target),r=t.parent(),s=t.data("code");r.find("li").removeClass("current"),t.addClass("current"),r.hasClass("type")?this.filter.type=s:r.hasClass("status")&&(this.filter.status=s)},doCheckAction:function(e){var t=$.trim($(e.target).val()),r=$(e.target).closest(".search").find(".g_btn_s");t.length>0?r.removeClass("g_btns_disable"):r.addClass("g_btns_disable")},doSearchAction:function(e){if(!$(e.currentTarget).hasClass("g_btns_disable")){var t=this,r="orders/searchresult?searchfrom="+t.searchFrom;if($(e.target).hasClass("type"))r+=",byid=false"+("NULL"==t.filter.type?"":",type="+t.filter.type)+("NULL"==t.filter.status?"":",status="+t.filter.status),t.gotoSearch(r);else if($(e.target).hasClass("order")){var s=$.trim(this.$el.find(".txt_order").val());if(r+=",byid=true,orderid="+s,!s||!/^[0-9]+$/.test(s))return void this.showMessage("订单号输入有误，请重新输入。");o.param.PageIndex=1,delete o.param.BookingDateTime,o.setParam("OrderIDs",s),t.showLoading(),o.excute(function(e){t.hideLoading(),e&&e.Result&&0==e.Result.ResultCode&&e.OrderEnities&&e.OrderEnities.length>0?t.gotoSearch(r):t.emptyAlert(s)},function(){t.hideLoading(),t.emptyAlert(s)},!0,this,function(){t.hideLoading(),t.emptyAlert(s)})}}},onHide:function(){delete o.param.OrderIDs},getQueries:function(){var e=location.href.slice(location.href.indexOf("?")+1),t=e.split("&"),r="",s=null,i="";this.queries=[];for(var a=0,o=t.length;o>a;a++)if(r=t[a],r.indexOf(",")>-1){s=r.split(",");for(var l=0,n=s.length;n>l;l++)i=s[l].split("="),2===i.length&&(this.queries[i[0].toLowerCase()]=i[1])}else i=r.split("="),2===i.length&&(this.queries[i[0].toLowerCase()]=i[1])},gotoSearch:function(e){Lizard.jump(Lizard.appBaseUrl+e)},emptyAlert:function(e){this.showMessage("您没有编号为"+e+"的订单")}});return l});